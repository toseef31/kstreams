<div class="container-fluid" id="MainWrap" ng-controller="dashController">
  <!-- file upload throught button -->
  <form style="display: none">
    <input type="file" name="avatar" file-input="files" multiple />
    <button type="button" ng-click="upload()">submit</button>
  </form>
  <!-- file upload code ends -->

  <h1 ng-if="sessionDestroy">Session destroyed please login</h1>
  <div class="row" ng-if="!sessionDestroy">
    <!-- ----------------------------  -------------------------------------------------------- -->
    <!-- ---------------------------- LEFT BAR -------------------------------------------------- -->
    <!-- ----------------------------  -------------------------------------------------------- -->

    <div class="col-sm-4 col-md-3 col-lg-3 mobilerightpane"
      ng-click="disableMsgEdit(); showDDwnDisabler(); $event.stopPropagation()">
      <form method="post" class="messages-search-users-form">

        <div class="headind_srch">
          <div class="recent_heading width100">
            <div class="pro_img">
              <span ng-if="!user.user_image || user.user_image=='' || !projectData.profileImgLocation">
                <img class="importantHeight" src="images/noProfile.png" alt="{{user.name}}" />
              </span>
              <span ng-if="user.user_image && user.user_image != '' && projectData.profileImgLocation">
                <img class="importantHeight" src="{{projectData.profileImgLocation}}{{user.user_image}}"
                  alt="{{user.name}}" />
              </span>
            </div>
            <div class="statusDropDown hoverIt" ng-click="showDDwnSt(); $event.stopPropagation()" ng-class="stClass"
              ng-mouseover="imgStDrop(1)" ng-mouseout="imgStDrop(0)">
              <div class="fa fa-angle-down hidden stAngleDd"></div>
            </div>
            <h4>{{user.name}}</h4>
            <!-- <a href='javascript:void(0)' class='btn btn-default btnLogOut ' ng-click="logout()">
              <span class='glyphicon glyphicon-log-out'></span> Logout
            </a> -->
          </div>
        </div>

        <!-- ------------------- SEARCH FIELD ---------------------------------------------------- -->
        <div class="form-group inner-addon left-addon messages-search-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            class="feather feather-search">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
          </svg>
          <input ng-model="keyword" type="text" name="query" id="query" class="form-control customPadding"
            placeholder="Search" autocomplete="off">
        </div>

        <div ng-if="projectData.broadcasting == 1"
          class='broadCastSec clearfix broadCaster col-sm-12 col-md-12 col-lg-12'>
          <div class="col-md-6 col-xs-6">
            <button id="live" type="button" ng-click="openBrModal()" class="btn btn-info btn-sm">
              <span class="glyphicon glyphicon-signal"></span> Live Broadcasting
            </button>
          </div>

          <div class="col-md-6 col-sm-7 col-xs-6 text-right broadCastAv">
            <a class="forceWhiteColor" href='javascript:void(0)' ng-click="openAvModal()">
              Available ({{presenterArr.length}})
            </a>
          </div>
        </div>

        <div id="live" class="backgroundOfficialGreen sharedScreen cursorPointer col-sm-12 col-md-12 col-lg-12"
          ng-click="openssViewerModal()">
          <span class='glyphicon glyphicon-th-list whiteColor'></span>
          <span class="whiteColor">Shared-Screens</span>
        </div>

        <!-- -------------------- --------------------------------------------------------- -->
        <!-- -------------------- TABS --------------------------------------------------------- -->
        <!-- -------------------- --------------------------------------------------------- -->

        <ul id="moodtabs" class=" nav nav-tabs wo_msg_tabs side bar tabs">
          <li id="tabs1" class="tab mbutton current" ng-click="chatActive(0)">
            <a data-toggle="tab" data-target="#users-message" id="user-message-tab">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="feather feather-message-square" ng-class="{grpChecked: $parent.selection==$index}">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
              </svg>
              Users
            </a>
          </li>
          <li id="tabs2" class="tab mbutton" ng-click="groupChatActive(0)" style="border-left: 2px solid #a3c3a3;">
            <a data-toggle="tab" data-target="#groups-message" id="groups-message-tab">

              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="feather feather-grid">
                <rect x="3" y="3" width="7" height="7"></rect>
                <rect x="14" y="3" width="7" height="7"></rect>
                <rect x="14" y="14" width="7" height="7"></rect>
                <rect x="3" y="14" width="7" height="7"></rect>
              </svg>
              Groups

            </a>
          </li>
          <li id="tabs3" class="tab mbutton wo_msg_tabs_custom" ng-click="openCreateGroupModal()">
            <a data-toggle="tab" data-target="#groups-message" id="groups-message-tab">
              <i class="fa fa-plus createGroupIcon" aria-hidden="true"></i>
            </a>
          </li>
        </ul>

        <!--  ----------------- ---------------------------------------------------------- -->
        <!--  ------------------ USERS LIST ------------------------------------------------ -->
        <!--  ----------------- ---------------------------------------------------------- -->

        <div id="usersList" class="tab-content messages-users-list">

          <div ng-if="!groupSelected">
            <div id="users-message" class="messages-chat-list">
              <div ng-if="allUsers.length > 1">
                <div class="messages-recipients-list mobileopenlist" id="messages-recipient-3"
                  ng-repeat="userA in allUsers | search: keyword | orderBy: '-tempDate'"
                  ng-class="{grpChecked: $parent.selection==$index, selectedUserColor: selectedUserNo==$index}"
                  ng-click="$parent.selection=$index" ng-if="userA._id != user._id">

                  <div ng-click="startChat({type:1,user:userA, userIndex:$index , isChatDocker: 0})">
                    <span class="user-name-section">
                      <div class="pull-right">
                        <span class="new-message-alert hidden">0</span>
                      </div>
                      <div class="avatar pull-left">
                        <span ng-if="userA.onlineStatus == 0">
                          <span class="status userStatusMargin" ng-class="{offlineSt:userA.onlineStatus==0}"></span>
                        </span>
                        <span ng-if="userA.onlineStatus == 1">
                          <span class="status userStatusMargin"
                            ng-class="{activeSt:userA.pStatus==0,awaySt:userA.pStatus==1,dDisturbSt:userA.pStatus==2,invisSt:userA.pStatus==3}"></span>
                        </span>

                        <span ng-if="userA.user_image == '' || !projectData.profileImgLocation">
                          <img class="" ng-if="userA.receiverId != user._id" src="images/noProfile.png"
                            alt="{{user.name}}" />
                        </span>
                        <span ng-if="userA.user_image != '' && projectData.profileImgLocation">
                          <img class="" ng-if="userA.receiverId != user._id"
                            src="{{projectData.profileImgLocation}}{{userA.user_image }}" alt="{{userA.name}}" />
                        </span>
                      </div>
                      <div class="messages-user-name" style="padding: 18px 0 0 0;">
                        <span>{{userA.name}}</span>
                        <span ng-if="userA.hasOwnProperty('usCount')">
                          <span class="unreadMsgAlign" ng-if="userA.usCount != 0">
                            <span class="badge badge-pill badge-warning unreadBadge">{{userA.usCount}}</span>
                          </span>
                        </span>
                      </div>

                      <div>
                        <span class="userTitleText">{{userA.userTitle}}</span>
                      </div>
                    </span>
                    <div class="clear"></div>
                  </div>
                </div>
              </div>
            </div>

            <div ng-if="allUsers.length <=1">
              <div class="notfound">
                <p class="text-center">No friends found</p>
              </div>
            </div>

            <div ng-if="!usersLoaded">
              <img class="contatctLoadingImage" src="/images/loading.gif">
              <!-- <strong class="loadingText">Loading...</strong> -->
            </div>
          </div>
          <!--  ----------------- ---------------------------------------------------------- -->
          <!--  ----------------- GROUPS lIST ------------------------------------------------ -->
          <!--  ----------------- ---------------------------------------------------------- -->

          <div id="groups-message" class="messages-group-list">
            <div ng-if="groupSelected">
              <div ng-if="allGroups.length > 0">
                <div class="messages-recipients-list mobileopenlist" id="messages-recipient-3"
                  ng-repeat="groupA in allGroups| search: keyword"
                  ng-class="{grpChecked: $parent.selection==$index, selectedUserColor: selectedUserNo==$index}"
                  ng-click="$parent.selection=$index">
                  <div ng-click="startChat({type:2,group:groupA, groupIndex:$index, isChatDocker: 0})">

                    <span class="user-name-section">
                      <div class="avatar pull-left">
                        <img alt="Kim Steve Profile Picture" src="../images/profile-photos/noProfile.png">
                      </div>

                      <span class="messages-user-name lineHeightGroupList">{{groupA.name}}</span>
                      <!-- <br ng-if='groupA.joinCall==true' /> -->
                      <span ng-if='groupA.joinCall==true' class="callStatus">Group call</span>
                    </span>

                    <div class="clear"></div>
                  </div>
                </div>
              </div>

              <div ng-if="allGroups.length <= 0" class="notfound">
                <p class="text-center">No groups found</p>
              </div>
            </div>
          </div>
        </div>
      </form>

      <ul class="statusDrpOptions hoverIt" ng-class="showDrpDwnSt?'':'hidden'">
        <li ng-class="currSt==0?'active':''" ng-click='changeSt(0)'>Active</a></li>
        <li ng-class="currSt==1?'active':''" ng-click='changeSt(1)'>Away</li>
        <li ng-class="currSt==2?'active':''" ng-click='changeSt(2)'>Do not disturb</li>
        <li ng-class="currSt==3?'active':''" ng-click='changeSt(3)'>Invisible</li>
      </ul>
    </div>
    <!-- --------------------- ----- ------------------------------------------------------ -->
    <!-- --------------------- CHAT PANEL ---------------------------------------------------- -->
    <!-- --------------------- ----- ------------------------------------------------------ -->
    <div class="col-sm-8 col-md-9 col-lg-9 mobileleftpane" ng-class="{hidden: !isChatPanel && isSidePanel}">
      <ul class="list-group text-sender-container"
        ng-click="disableMsgEdit(); showDDwnDisabler(); $event.stopPropagation()">

        <!-- ----------------------------- HEADER ------------------------------------------------------ -->
        <li class="list-group-item red-list active-list text-muted chatHeaderColor" contenteditable="false">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            class="feather feather-chevron-left mobilemsgclose" style="color:white" ng-click="chatBack()">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>

          <span id="user-name" class="">
            <!-- https://peekhelpers.com/job-detail/office-staff-required-1 -->
            <!-- http://peekhelpers.com/profile/4489 -->
            <span class="status-bar participants" ng-if="groupSelected" ng-click="openEditGroup()"> {{selGroupName}}
            </span>
            <span class="participants" ng-if="groupSelected" ng-click="openEditGroup()">({{selGrpMembers.length}}
              Participants)</span>
            <a ng-if="userProfileUrl != ''" href="{{userProfileUrl}}" target="_blank">
              <span class="status-bar whiteTextColor" ng-if="!groupSelected"> {{selUserName}} </span>
            </a>
            <span ng-if="userProfileUrl == '' && !groupSelected" class="status-bar whiteTextColor">
              {{selUserName}}
            </span>
          </span>

          <span class="pull-right userInteraction">
            <span ng-if="!groupSelected" ng-class="{unavailableButton: selectedUserData.pStatus != 0}"
              class="whiteTextColor marginRight20" ng-attr-title="{{CallTitle}}" ng-click="openssShareModal()">
              <i id="screenShare" class="fa fa fa-slideshare"></i>
            </span>

            <span ng-class="{unavailableButton: selectedUserData.pStatus != 0}"
              ng-if="projectData.videoCall == 1 && !groupSelected" ng-attr-title="{{CallTitle}}"
              class="whiteTextColor marginRight20">
              <i id="videoCall" class="fa fa fa-video-camera" ng-click="videoCall(0)"></i>
            </span>

            <span ng-if="!groupSelected" ng-class="{unavailableButton: selectedUserData.pStatus != 0}"
              ng-attr-title="{{CallTitle}}" ng-if="projectData.audioCall == 1" class="whiteTextColor">
              <i id="call" class="fa fa-phone" ng-click="videoCall(1, user._id)"></i>
            </span>

            <!-- ------------------------- GROUP CALL BUTTONS ---------------------------------------- -->
            <span ng-if="projectData.videoCall == 1 && groupSelected && !groupCallMinimized"
              class="whiteTextColor marginRight20">
              <i id="groupVideoCall" ng-if="!selGroupData.joinCall" class="fa fa fa-video-camera"
                ng-click="videoCall(0,0,0)"></i>

              <span ng-if="selGroupData.joinCall" class="callStatus ng-scope" ng-click="videoCall(0,0,1)">Join
                Call</span>
            </span>

            <span ng-if="groupSelected && projectData.audioCall == 1" class="whiteTextColor">
              <i id="call" class="fa fa-phone" ng-click="videoCall(1, user._id, 0)"></i>
            </span>

            <!-- FOR TESTING PURPOSES - WILL BE REMOVED IN FUTURE -->
            <!-- <a href='javascript:void(0)' ng-click="testJoinFunction()" class='btn btn-primary'>Join</a>
            <a href='javascript:void(0)' ng-click="testLeaveFunction()" class='btn btn-primary'>User Leave</a> -->
            <!-- ------------------------- ------------------ ---------------------------------------- -->

          </span>
        </li>

        <div ng-if="isPagination" class="loader" style="position: relative; left: 40%;"></div>

        <div onscroll="scrolled(this)" class="messagejoint msg_history" ng-class="{groupMsgHistory: groupSelected}"
          id="{{connectionId}}" file-dropzone files-to-upload='files' ng-mouseout="removeClasses()">
          <div class="messages-container">

            <div id="dropImage" class="dropImage">
              <img height="22%" width="22%" src="../images/fileDrop_image.png">
            </div>

            <!-- --------------  -------------------------------------------------------- -->
            <!-- -------------- NORMAL CHAT ------------------------------------------------ -->
            <!-- --------------  -------------------------------------------------------- -->

            <div ng-if="!groupSelected">
              <div ng-repeat="chat in chats track by $index">

                <!-- ---------------------  RECEIVED MESSAGES -------------------------------------->
                <div class="gap-btw-msg" ng-if="chat.senderId._id != user._id" ng-mouseover="showReplyIcon(chat._id,1)"
                  ng-mouseout="showReplyIcon(chat._id,0)">
                  <div ng-if="selectedUserData.user_image != ''" class="message-user-image pull-left">
                    <img src="{{projectData.profileImgLocation}}{{selectedUserData.user_image}}" alt="User image">
                  </div>

                  <div ng-if="selectedUserData.user_image == ''" class="message-user-image pull-left">
                    <img src="images/noProfile.png" alt="User image">
                  </div>

                  <div ng-if="!chat.isDeleted">
                    <div class="message-contnaier incoming pull-left">
                      <div class="messages-wrapper messages-text message-model pull-left">
                        <div class="clear"></div>

                        <div class="time ajax-time text-right" title="{{chat.createdAt | date:'MM/dd/yy h:mm:ss a'}}">
                          {{selectedUserData.name}}, {{chat.createdAt | timeago}}
                        </div>

                        <div class="message" ng-if="chat.messageType == 0  && chat.chatType == 0">
                          <p class="message-text" dir="auto"> {{chat.message}} </p>
                          <div class="message-media">
                            <div class="clear"></div>
                          </div>
                        </div>

                        <!-- --------------- REPLY MSG ---------------------------------------------- -->
                        <div class="message" ng-if="chat.chatType == 1">
                          <p class="message-text" dir="auto">
                            <div class="panel panel-default replyPanel">
                              <div class="panel-body">{{chat.commentId.message}}</div>
                            </div>
                            {{chat.message}}
                          </p>
                          <div class="message-media">
                            <div class="clear"></div>
                          </div>
                        </div>

                        <a href="download/{{chat.message}}" ng-if="chat.messageType == 1">
                          <img src="/images/chatImages/{{chat.message}}" alt="{{chat.name}}" />
                        </a>
                        <a href="download/{{chat.message}}" ng-if="chat.messageType == 2">
                          <img class="messageType2Width" src="/images/fileIcon.png" alt="{{chat.name}}" />
                          <span>{{chat.message}}</span>
                        </a>

                      </div>

                      <span class="replyMenu" ng-if="replyIconId == chat._id" id="replyIcon-{{chat._id}}">
                        <span class='hoverIt fa fa-reply' ng-click="activateReply(chat)"></span>
                      </span>

                    </div>
                  </div>

                  <div ng-if="chat.isDeleted">
                    <div class="message-contnaier incoming pull-left">
                      <div class="messages-wrapper messages-text message-model pull-left">
                        <div class="time ajax-time text-right" title="{{chat.createdAt | date:'MM/dd/yy h:mm:ss a'}}">
                          {{chat.createdAt | timeago}}
                        </div>
                        <div class="deleted_received_msg">this message has been deleted</div>
                      </div>
                    </div>
                  </div>
                  <div class="clear"></div>
                </div>

                <!-- ---------------------  SENDING MESSAGES -------------------------------------->
                <div class="gap-btw-msg" ng-mouseover="showHideDots(chat._id,1)" ng-mouseout="showHideDots(chat._id,0)"
                  ng-if="chat.senderId._id == user._id">
                  <div ng-if="!chat.isDeleted">

                    <div class="clear"></div>

                    <div class="message-contnaier outgoing pull-right">
                      <div class="messages-wrapper messages-text message-model pull-right rightAlign">
                        <div class="clear"></div>
                        <div class="time ajax-time text-right" title="{{chat.createdAt | date:'MM/dd/yy h:mm:ss a'}}">
                          {{ chat.createdAt | timeago }}
                        </div>

                        <!-- --------------- NORMAL MSG ---------------------------------------------- -->
                        <div class="message" ng-if="chat.chatType == 0">
                          <p class="message-text" dir="auto">
                            {{chat.message}}
                            <img ng-if="chat.isSeen == 0 && user.seenStatus == 1" src="../images/unseenMsg.png"
                              width="20px" height="20px">
                            <img ng-if="chat.isSeen == 1 && user.seenStatus == 1" src="../images/seenMsg.png"
                              width="20px" height="20px">
                          </p>
                          <div class="message-media">
                            <div class="clear"></div>
                          </div>
                        </div>

                        <!-- --------------- REPLY MSG ---------------------------------------------- -->
                        <div class="message" ng-if="chat.messageType == 0 && chat.chatType == 1">
                          <p class="message-text" dir="auto">
                            <div class="panel panel-default replyPanel">
                              <div class="panel-body">{{chat.commentId.message}}</div>
                            </div>
                            {{chat.message}}
                            <img ng-if="chat.isSeen == 0 && user.seenStatus == 1" src="../images/unseenMsg.png"
                              width="20px" height="20px">
                            <img ng-if="chat.isSeen == 1 && user.seenStatus == 1" src="../images/seenMsg.png"
                              width="20px" height="20px">
                          </p>
                          <div class="message-media">
                            <div class="clear"></div>
                          </div>
                        </div>

                        <!-- --------------- IMAGE MSG ---------------------------------------------- -->
                        <a href="download/{{chat.message}}" ng-if="chat.messageType == 1">
                          <img src="/images/chatImages/{{chat.message}}" ng-click="download(chat.message)" />
                        </a>

                        <!-- --------------- FILE MSG ---------------------------------------------- -->

                        <a class="messageType2 msgType2CenterAlign" href="download/{{chat.message}}"
                          ng-if="chat.messageType == 2">
                          <img class="messageType2Width" src="/images/fileIcon.png" alt="{{chat.name}}" />
                          <span class="msgType2Margin">{{chat.message}}</span>

                          <img ng-if="chat.isSeen == 0 && user.seenStatus == 1" src="../images/unseenMsg.png"
                            style="float: right" width="20px" height="20px">
                          <img ng-if="chat.isSeen == 1 && user.seenStatus == 1" src="../images/seenMsg.png"
                            style="float: right" width="20px" height="20px">
                        </a>

                      </div>

                      <ul class="chatMenu" ng-if="editMsgId == chat._id && editMsgMenu1">
                        <li>
                          <span id="replyIcon-{{chat._id}}">
                            <span class='hoverIt fa fa-reply' ng-click="activateReply(chat)"></span>
                          </span>
                          <span ng-if="chat.messageType == 0" class='hoverIt fa fa-edit' tooltip-placement="left"
                            uib-tooltip="Edit" ng-click="editMsg()"></span>
                          <span class='hoverIt fa fa-remove' tooltip-placement="left" uib-tooltip="For me"
                            ng-click="confirmModal()"></span>
                          <!-- deleteMsg('fromMe')  -->
                        </li>
                      </ul>

                      <div class="top-left">
                        <img src="images/3dots.png" id='msg3dots-{{chat._id}}' style="left: 47%;"
                          class="msg3dotsNew hoverIt hidden" ng-click="editMenu(chat); $event.stopPropagation()" />
                      </div>
                    </div>

                    <div class="clear"></div>
                  </div>

                  <div class="message-contnaier outgoing pull-right" ng-if="chat.isDeleted">
                    <div class="messages-wrapper messages-text message-model pull-right">
                      <div class="clear"></div>
                      <div class="time ajax-time text-right" title="{{chat.createdAt | date:'MM/dd/yy h:mm:ss a'}}">
                        {{ chat.createdAt | timeago }}
                      </div>
                      <div class="message">
                        <p class="message-text" dir="auto">
                          this message has been deleted
                        </p>
                        <div class="message-media">
                          <div class="clear"></div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <span ng-if="$index == (chats.length-1) && !isRepeatFinish">
                  {{ngRepeatFinish()}}
                </span>

                <div class="clear"></div>
              </div>
            </div>

            <!-- --------------  -------------------------------------------------------- -->
            <!-- -------------- GROUP CHAT ------------------------------------------------ -->
            <!-- --------------  -------------------------------------------------------- -->

            <div ng-if="groupSelected">
              <div ng-repeat="chat in groupchats track by $index">
                <!-- ---------------------  RECEIVED MESSAGES -------------------------------------->
                <div class="gap-btw-msg" ng-if="chat.senderId._id != user._id" ng-mouseover="showReplyIcon(chat._id,1)"
                  ng-mouseout="showReplyIcon(chat._id,0)">
                  
                  <div ng-if="!chat.isDeleted">
                    <div class="message-contnaier incoming pull-left">
                      <div class="messages-wrapper messages-text message-model pull-left">
                        <div class="clear"></div>
                        <div class="message" ng-if="chat.messageType == 0 && chat.chatType == 0">
                          <strong>{{chat.senderId.name}}</strong>
                          <p class="message-text" dir="auto"> {{chat.message}} </p>
                          <div class="message-media">
                            <div class="clear"></div>
                          </div>
                        </div>
                        <!-- --------------- REPLY GROUP MSG ------------------------------------------ -->
                        <div class="message" ng-if="chat.chatType == 1">
                          <p class="message-text" dir="auto">
                            <div class="panel panel-default replyPanel">
                              <div class="panel-body">{{chat.commentId.message}}</div>
                            </div>
                            {{chat.message}}
                          </p>
                          <div class="message-media">
                            <div class="clear"></div>
                          </div>
                        </div>
                        <a href="download/{{chat.message}}" ng-if="chat.messageType == 1">
                          <img src="/images/chatImages/{{chat.message}}" alt="{{chat.name}}" />
                        </a>
                        <a href="download/{{chat.message}}" ng-if="chat.messageType == 2">
                          <img class="messageType2Width" src="/images/fileIcon.png" alt="{{chat.name}}" />
                          <span>{{chat.message}}</span>
                        </a>

                        <div class="time ajax-time text-right" title="{{chat.createdAt | date:'MM/dd/yy h:mm:ss a'}}">
                          {{ chat.createdAt | timeago}}
                        </div>
                      </div>

                      <span class="replyMenu" ng-if="replyIconId == chat._id" id="replyIcon-{{chat._id}}">
                        <span class='hoverIt fa fa-reply' ng-click="activateReply(chat)"></span>
                      </span>

                    </div>
                    <div class="clear"></div>
                  </div>

                  
                  <div ng-if="chat.isDeleted">
                    <div class="message-contnaier incoming pull-left">
                      <div class="messages-wrapper messages-text message-model pull-left">
                        <div class="deleted_received_msg">this message has been deleted
                        </div>
                        <div class="time ajax-time text-right" title="{{chat.createdAt | date:'MM/dd/yy h:mm:ss a'}}">
                          {{chat.createdAt | timeago}}
                        </div>
                      </div>
                    </div>
                    <div class="clear"></div>
                  </div>

                </div>

                <!-- ---------------------  SEND MESSAGES -------------------------------------->

                <div ng-mouseover="showHideDots(chat._id,1)" ng-mouseout="showHideDots(chat._id,0)"
                  ng-if="chat.senderId._id == user._id">
                  <div ng-if="!chat.isDeleted">

                    <div class="clear"></div>

                    <div class="message-contnaier outgoing pull-right">
                      <div class="messages-wrapper messages-text message-model pull-right rightAlign">
                        <div class="clear"></div>

                        <!-- --------------- NORMAL MSG ---------------------------------------------- -->
                        <div class="message" ng-if="chat.messageType == 0 && chat.chatType == 0">
                          <p class="message-text" dir="auto">
                            {{chat.message}}
                          </p>
                          <div class="message-media">
                            <div class="clear"></div>
                          </div>
                        </div>

                        <!-- --------------- REPLY GROUP MSG ------------------------------------------ -->
                        <div class="message" ng-if="chat.chatType == 1">
                          <p class="message-text" dir="auto">
                            <div class="panel panel-default replyPanel">
                              <div class="panel-body">{{chat.commentId.message}}</div>
                            </div>
                            {{chat.message}}
                          </p>
                          <div class="message-media">
                            <div class="clear"></div>
                          </div>
                        </div>

                        <!-- --------------- IMAGE MSG ---------------------------------------------- -->
                        <a href="download/{{chat.message}}" ng-if="chat.messageType == 1">
                          <img src="/images/chatImages/{{chat.message}}" ng-click="download(chat.message)" />
                        </a>

                        <!-- --------------- FILE MSG ---------------------------------------------- -->

                        <a class="messageType2 msgType2CenterAlign" href="download/{{chat.message}}"
                          ng-if="chat.messageType == 2">
                          <img class="messageType2Width" src="/images/fileIcon.png" alt="{{chat.name}}" />
                          <span class="msgType2Margin">{{chat.message}}</span>
                        </a>


                        <div class="time ajax-time text-right" title="{{chat.createdAt | date:'MM/dd/yy h:mm:ss a'}}">
                          {{ chat.createdAt | timeago}}
                        </div>
                      </div>

                      <ul class="chatMenu" ng-if="editMsgId == chat._id && editMsgMenu1">
                        <li>
                          <span id="replyIcon-{{chat._id}}">
                            <span class='hoverIt fa fa-reply' ng-click="activateReply(chat)"></span>
                          </span>
                          <span ng-if="chat.messageType == 0" class='hoverIt fa fa-edit' tooltip-placement="left"
                            uib-tooltip="Edit" ng-click="editMsg()"></span>
                          <span class='hoverIt fa fa-remove' tooltip-placement="left" uib-tooltip="For me"
                            ng-click="confirmModal()"></span>
                        </li>
                      </ul>
                      <div class="top-left">
                        <img src="images/3dots.png" id='msg3dots-{{chat._id}}' style="left: 47%;"
                          class="msg3dotsNew hoverIt hidden" ng-click="editMenu(chat); $event.stopPropagation()" />
                      </div>

                    </div>

                    <div class="clear"></div>
                  </div>
                  
                  <div class="message-contnaier outgoing pull-right" ng-if="chat.isDeleted">
                    <div class="messages-wrapper messages-text message-model pull-right">
                      <div class="clear"></div>
                      <div class="message">
                        <p class="message-text" dir="auto">
                          this message has been deleted
                        </p>
                        <div class="message-media">
                          <div class="clear"></div>
                        </div>
                      </div>

                      <div class="time ajax-time text-right" title="{{chat.createdAt | date:'MM/dd/yy h:mm:ss a'}}">
                        {{ chat.createdAt | timeago }}

                      </div>
                    </div>
                  </div>

                </div>
                <!-- NEEEEED REEECHECKING NINININI (640) -->

                <span ng-if="$index == (groupchats.length-1) && !isRepeatFinish">
                  {{ngRepeatFinish()}}
                </span>
                <div class="clear"></div>
              </div>
            </div>
          </div> <!-- ---NG REPEAT ENDS --- -->
        </div>

        <div id='isTyping' class='hidden'> </div>

        <!--- ------------------------ SEND MESSAGE BOX ------------------------------------ -->
        <div>
          <div id="applyPic" class="input-group type_msg" ng-class="{type_msgMarginTopOvrr: isReplying == true }">

            <div id="commentsReply" class="showCommentsReply panel panel-default">
              <span ng-if="selectedMsg.messageType == 0">
                {{selectedMsg.message}}
              </span>

              <span ng-if="selectedMsg.messageType == 1">
                <img class="inputBoxImage" src="/images/chatImages/{{selectedMsg.message}}" />
              </span>

              <i class="fa fa-close exitReplyIcon" ng-click="deActivate()"></i>
            </div>

            <div style="position:relative" ng-click="unreadMsg({userId:selectedUserId})">
              <input type="text" id="sendMsg" class="form-control border0"
                ng-keydown="$event.keyCode === 13 && sendMessage()" ng-model="message" placeholder="Type a message">

              <span class="input-group-btn message-option-btns">
                <div class="col-md-1 col-xs-2 chatIcons">
                  <span class='hoverIt' ng-click="sendMessage(0,message)">
                    <i class="fa fa-send" style="line-height: 2"></i>
                  </span>
                  <span class='hoverIt' onclick="triggerfile()">
                    <i class="fa fa-paperclip"></i>
                  </span>
                </div>
              </span>
            </div>

            <span class="input-group-btn" ng-click="sendMessage(0,message)">
              <button id="sendMsgButton" class="btn-main btn btn-file MS-File send-button marginSendButton"
                type="button">
                <i class="fa fa-arrow-right"></i></button>

            </span>
          </div>
        </div>
      </ul>
    </div>

    <!-- ------------------ IF NO MSG CHATPANEL IS ACTIVATED ---------------------------------------- -->
    <div class="col-sm-8 col-md-9 col-lg-9 hideNoMsgChatPanel" style="padding-left: 0; padding-right: 0"
      ng-if="!isChatPanel">
      <ul class="list-group text-sender-container"
        ng-click="disableMsgEdit(); showDDwnDisabler(); $event.stopPropagation()">

        <li class="list-group-item red-list active-list text-muted chatHeaderColor" contenteditable="false">
          <span id="user-name" class="">
            <span class="status-bar whiteTextColor"> Chat </span>
          </span>
        </li>

        <div class="nomessage-container messagejoint msg_history">
          <div class="noMessageContainerText">
            <i class="fa fa-comments-o chatIcon"></i>
            <h4 style="font-size: xx-large;"> Select User From List</h4>
            <h6 style="font-size: larger;">to Start Chat</h6>
          </div>
        </div>
      </ul>
    </div>

    <div class="videoTabNew 2wayChat">
      <div id="remotes" class="ui large">
        <video id="videoOutput" controls ng-class="{videoOutputFullscreen: isChatFullscreen == true }" autoplay
          poster="images/webrtc.png"></video>
      </div>
      <video id="local-video" controls ng-class="{localVideoFullscreen: isChatFullscreen == true }" autoplay
        poster="images/webrtc.png"></video>

      <div class="text-center screenButtons">
        <h4 id="timmer" class="hidden-xs"></h4>
        <button class="trans-btn exitTheScreen hidden" ng-click='fullscreenStatus()' title="Exit full screen">
          <img src="images/exitFullScreen.png">
        </button>
        <button class="trans-btn makeFullScreen" ng-click='fullscreenStatus()' title="Full screen">
          <img src="images/fullScreen.png">
        </button>
        <button class="trans-btn " ng-if="openVoice" ng-click='toggelMute()' title="Mute video">
          <img src="images/unmute1.png">
        </button>
        <button class="trans-btn " ng-if="!openVoice" ng-click='toggelMute()' title="Unmute video">
          <img src="images/mute1.png">
        </button>

        <button class="trans-btn" ng-if='showVideo' ng-click='toggelVideo()' title="Hide video">
          <img src="images/pause1.png">
        </button>
        <button class="trans-btn" ng-if='!showVideo' ng-click='toggelVideo()' title="Display video">
          <img src="images/resume1.jpg">
        </button>

        <!--<button class="trans-btn" title="share screen" onclick="shareScreen()"><img src="images/sharescreen.png"></button> -->
        <button class="trans-btn" title="call drop" ng-click="stopCall(1,chatWith || callerId);">
          <img src="images/calldrop2.png"></button>
      </div>
    </div>
  </div>


  <div id="checker" style="display: none"></div>

  <div class="audioTab">
    <div class='hidden'>
      <audio id="audioOutput" autoplay controls></audio>
      <audio id="audioInput" autoplay controls></audio>
    </div>
    <div class="incomming-card">
      <h4 id="audioTimmer"></h4>
    </div>
    <div class="incomming-btn-container">
      <button class="trans-btn " ng-if="openVoice" ng-click="toggelMute()" title="Mute video">
        <img src="images/unmute1.png">
      </button>
      <button class="trans-btn " ng-if="!openVoice" ng-click="toggelMute()" title="Unmute video">
        <img src="images/mute1.png">
      </button>
      <button class="trans-btn" title="call drop" ng-click="stopCall(1,chatWith || callerId);">
        <img src="images/calldrop.png">
      </button>
    </div>
  </div>

  <!-- incoming screenShare modal -->
  <!-- incoming screenShare modal -->
  <!-- <div id="incomingScreenshare">
    <div class="incomming-card">
      <h3 id="screenerName"></h1>  <h4>incomming screenshare</h4>
    </div>
    <div class="incomming-btn-container">
      <button title="Accept" class="join"
        ng-click="">
        <i class="fa fa-phone color-green" aria-hidden="true"></i>
      </button>
      <button title="Decline" ng-click="" class="incomming-card-btn danger pull-right">
        <i class="fa fa-ban color-red" aria-hidden="true"></i>
      </button>
    </div>
  </div> -->

  <!-- incomming call modal -->
  <!-- incomming call modal -->
  <div id="incommingCall">
    <div class="incomming-card">
      <h4>incomming call</h4>
      <h1 id="callerName"></h1>
    </div>
    <div class="incomming-btn-container">
      <button title="Accept" class="incomming-card-btn success pull-left" ng-click="joinCall();">
        <i class="fa fa-phone color-green" aria-hidden="true"></i>
      </button>
      <button title="Decline" ng-click="callDrop('notReceive')" class="incomming-card-btn danger pull-right">
        <i class="fa fa-ban color-red" aria-hidden="true"></i>
      </button>
    </div>
  </div>

  <!-- Broadcasting modals start  -->
  <!-- Initial 1 start -->
  <div id="broadcastingModal" class="modal fade" role="dialog">
    <form ng-submit="broadcasting('video')">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">Live Stream</h4>
          </div>
          <div class="modal-body clearfix">
            <div class="form-group col-md-12">
              <div class="col-md-3">
                <label>Set password for live stream</label>
              </div>
              <div class="col-md-2 hoverIt">
                <input type="radio" id='setPas1' ng-model="setPassword" name="setPassword" value='1'
                  ng-checked='setPassword == 1' />
                <label for="setPas1">YES</label>
              </div>
              <div class="col-md-2 hoverIt">
                <input type="radio" id='setPas2' ng-model="setPassword" name="setPassword" value='0'
                  ng-checked='setPassword == 0' />
                <label for="setPas2">NO</label>
              </div>
            </div>
            <div class="form-group col-md-12" ng-class="{hidden:setPassword==0}">
              <div class="col-md-6 col-md-offset-3">
                <input type="text" placeholder="set password" ng-model="liveStreamCode" class="form-control">
              </div>
            </div>
            <div class="form-group col-md-12 text-center">
              <label>
                <button type="button" class="btn btn-info btn-sm" ng-click="activateVideoBroadcastPanel()">
                  <span class="glyphicon glyphicon-signal"></span> Broadcast Now !
                </button>
              </label>
            </div>
            <div class="col-md-12" ng-if='brErrorMsg'>
              <div class="alert alert-danger">Enter correct password</div>
            </div>

          </div>
          <div class="modal-footer">
            <button type="button" id="broadClose" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </form>
  </div>

  <!-- broadCasting Video-Panel Modal -->
  <!-- broadCasting Video-Panel Modal -->

  <div id="broadcastingVideoModal" class="modal fade" role="dialog" style="z-index: 1100">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Broadcasting...
          <p id="bctest"></p>
          <button ng-if="broadcastingStatus == 2" class="btn btn-danger btn-sm closeButton"
            ng-click="closeVideoBroadcastPanel()" style="float: right"> CLOSE </button>

          <button ng-if="broadcastingStatus == 1 || broadcastingStatus == 0" class="btn btn-danger btn-sm closeButton"
            ng-click="activateBCcloseModal()" style="float: right"> STOP </button>
        </h4>
      </div>

      <div class="modal-body clearfix bcSubMainPanels">
        <div class="bcSubPanelWidth" style="float:left">
          <video class="videoScreenSize" id="broadCastVideo" autoplay poster="images/webrtc.png">
          </video>

          <div class="text-center screenButtons braodcastButtonAlign">
            <h4 id="timmer" class="hidden-xs"></h4>
            <button class="trans-btn " ng-if="openBCvoice" ng-click='toggleBCMute()' title="Mute video">
              <img src="images/unmute1.png">
            </button>
            <button class="trans-btn " ng-if="!openBCvoice" ng-click='toggleBCMute()' title="Unmute video">
              <img src="images/mute1.png">
            </button>

            <button class="trans-btn" ng-if='showBCVideo' ng-click='toggleBCVideo()' title="Hide video">
              <img src="images/pause1.png">
            </button>
            <button class="trans-btn" ng-if='!showBCVideo' ng-click='toggleBCVideo()' title="Display video">
              <img src="images/resume1.jpg">
            </button>
          </div>
        </div>

        <div class="bcSubPanelWidth" style="background-color: #f8f3f3; float:right">
          <div class="messagejoint msg_history text-sender-container" ng-class="{groupBroadMsgHistory: true}"
            id="{{connectionId}}">
            <div class="messages-container">
              <div ng-repeat="chat in broadcastChats track by $index">
                <div class="clear"></div>
                <div class="message-contnaier outgoing pull-right">
                  <div class="messages-wrapper messages-text message-model pull-right rightAlign">
                    <div class="clear"></div>
                    <div class="message messageSendColor">
                      <span><b> {{chat.senderId.name}} </b></span>
                      <p class="message-text" dir="auto" ng-if="chat.chatType == 2">
                        {{chat.message}}
                      </p>
                      <div class="message-media">
                        <div class="clear"></div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="clear"></div>
              </div>
            </div>
          </div>

          <!--- ----------------------- SEND MESSAGE BOX ----------------------------------- -->
          <div class="input-group broadCast_type_msg"
            ng-keydown="$event.keyCode == 13 && sendBCMessage(sendType, 0,message)">
            <div style="position:relative">
              <input id="sendBMsg" type="text" class="form-control border0"
                ng-keydown="$event.keyCode == 13 && sendBCMessage(sendType, 0,message)" ng-model="message">

              <div class="input-group-btn bcMessage-option-btns">
                <div class="col-md-1 col-xs-2 chatIcons" ng-class="{chatIconsMargin: !isSafari}">
                  <span class='hoverIt' ng-click="sendBCMessage(sendType, 0,message)">
                    <i class="fa fa-send" style="line-height: 2"></i>
                  </span>
                  <span ng-if="!isSafari" class='hoverIt' onclick="triggerfile()">
                    <i class="fa fa-paperclip"></i>
                  </span>

                  <span ng-if="isSafari" class='hoverIt safari-message-option-btns-Spacer'>
                    <label for="safariUpload">
                      <span class="fa fa-paperclip"></span>
                    </label>
                  </span>
                </div>
              </div>
            </div>

            <span class="input-group-btn" ng-click="sendBCMessage(sendType, 0,message)">
              <button class="btn-main btn btn-file MS-File send-button marginSendButton broadcastSendButtonSize"
                type="button">
                <i class="fa fa-arrow-right"></i></button>
            </span>
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- stop confirmation Broadcast modal -->
  <!-- stop confirmation Broadcast modal -->
  <div id="cBroadcastModal" class="modal fade" role="dialog" style="z-index: 1200;">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title" id="modal-title">Confirmation</h3>
        </div>
        <div class="modal-body" id="modal-body">
          <ul>Are you sure you want to stop broadcasting?
          </ul>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" type="button" ng-click="deActivateVideoBroadcastPanel()">yes</button>
          <button class="btn btn-warning" type="button" ng-click="deActivateBCcloseModal()">no</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Show available presenter  -->
  <div id="avPresenterModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Presenters broadcasting now</h4>
        </div>
        <div class="modal-body">
          <div class="form-group col-md-12 clearfix">
            <ol ng-if="presenterArr.length>0">
              <li ng-repeat=" opt in presenterArr" ng-bind-html-unsafe="opt">
                <a href='javascript:void(0)' data-dismiss="modal" ng-click="becomeViewer(opt.preId,opt.password)">
                  {{ opt.preName }}
                </a>
                <i ng-if="opt.password">(Password required)</i>
              </li>
            </ol>
            <p class="text-center" ng-if="presenterArr.length==0">No presenter found</p>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  <!-- end -->

  <!-- Password required for presenter  -->
  <div id="passReqPre" class="modal fade" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Enter password</h4>
        </div>
        <div class="modal-body clearfix">
          <div class="form-group col-md-12 clearfix">
            <div class="col-md-6 col-md-offset-3">
              <input type="text" placeholder="Password" ng-model="checkPassword" class="form-control">
            </div>
          </div>

          <div class="form-group col-md-12 text-center">
            <label>
              <button type="button" class="btn btn-info btn-sm" ng-click="checkBPass()">
                Submit
              </button>
            </label>
          </div>

          <div class="col-md-12" ng-if='brErrorMsg'>
            <div class="alert alert-danger"> Enter correct password !</div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  <!-- end -->

  <!-- Modal for Screen Share-->
  <div id="ssShareModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Screen Share</h4>
        </div>
        <div class="modal-body clearfix screenSharebody">
          <!-- <div class='col-md-12 text-right'>
            <a href='javascript:void(0)' ng-click="openssViewerModal()">
              <span class='glyphicon glyphicon-th-list'></span> Shared Screens
            </a>
          </div> -->
          <iframe src="/sShare.html"></iframe>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  <!-- end -->

  <!-- screenShare Viewer modal -->
  <div id="ssViewerModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <p style="color: white;">Screen Shared By</p>
          <h4 id="screenerTitle" class="modal-title"></h4>
        </div>
        <div class="modal-body">
          <iframe id="viewerIframe" src="/sViewer.html"></iframe>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  <!-- end -->
  <!-- Broadcasting modals end  -->

  <!-- server connect modal -->
  <div class="alert alert-info alert-dismissible show callServerNoti" ng-if="projectData.videoCall == 1"
    ng-class="{hidden: o2oSocConEst}" role="alert">
    <span class='waitMsg'><strong>Wait!</strong> Connecting to calling server...</span>
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>

    <!-- ------------------- GROUP DELETE CONFIRMATION MODAL ------------------- -->
    <div id="groupDelConfirmModal" class="modal fade" role="dialog" style="z-index: 1200;">
      <div class="modal-dialog">
        <div class="modal-header">
          <h3 class="modal-title" id="modal-title">Confirmation</h3>
        </div>
        <div class="modal-body" id="modal-body" style="background-color: aliceblue;">
          Are you sure you want to delete the group?
        </div>
        <div class="modal-footer" style="background-color: aliceblue;">
          <button class="btn btn-primary" type="button" ng-click="DeleteGroup()">Ok</button>
          <button class="btn btn-warning" type="button" ng-click="confirmModalGroupDel()">Cancel</button>
        </div>
      </div>
    </div>
    <!-- ------------------- GROUP DELETE CONFIRMATION MODAL ------------------- -->

  <!-- ------------------- MSG DELETE CONFIRMATION MODAL ------------------- -->
  <div id="confirmationModal" class="modal fade" role="dialog" style="z-index: 1200;">
    <div class="modal-dialog">
      <div class="modal-header">
        <h3 class="modal-title" id="modal-title">Confirmation</h3>
      </div>
      <div class="modal-body" id="modal-body" style="background-color: aliceblue;">
        Are you sure you want to delete?
      </div>
      <div class="modal-footer" style="background-color: aliceblue;">
        <button class="btn btn-primary" type="button" ng-click="deleteMsg('fromMe')">Ok</button>
        <button class="btn btn-warning" type="button" ng-click="confirmModal()">Cancel</button>
      </div>
    </div>
  </div>
  <!-- ------------------- MSG DELETE CONFIRMATION MODAL ------------------- -->

  <!-- Create-Group modal  -->
  <div id="createGroupModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content createGroupModal">
        <div class="modal-header">
          <p style="color: white;">Create Group</p>
        </div>
        <div class="modal-body">
          <label for="gName">Group name:</label>
          <input id="gName" type="text" value="" placeholder="enter group name" ng-model="groupName" />
          <br>
          <span style="color: red" ng-if="!groupName || groupName== ''"> {{groupErrMsg}} </span>
          <br>
          <div style="margin-top: 8px; border-bottom: 1px solid rgb(39, 39, 39);"></div>

          <span class="selectUserErrMsg" ng-if="groupUsers.length <= 0"> {{noneSelectedErrMsg}} </span>

          <span class="userCount">Users added: {{groupUsers.length}}</span>
          <br>

          <div class="messages-recipients-list" id="messages-recipient-3" ng-repeat="userA in allUsers"
            ng-if="userA._id != user._id">

            <span class="user-name-section">
              <div class="avatar pull-left">
                <span ng-if="userA.user_image == '' || !projectData.profileImgLocation">
                  <img ng-if="userA.receiverId != user._id" src="images/noProfile.png" alt="{{user.name}}" />
                </span>
                <span ng-if="userA.user_image != '' && projectData.profileImgLocation">
                  <img ng-if="userA.receiverId != user._id"
                    src="{{projectData.profileImgLocation}}{{userA.user_image }}" alt="{{userA.name}}" />
                </span>
              </div>
              <div class="messages-user-name" style="padding: 18px 0 0 0;">
                <span>{{userA.name}}</span>
                <i ng-if="userA.isAdded" class="fa fa-check" style="color: #a0d459;" aria-hidden="true"></i>
              </div>
              <div class="messages-user-name userAddButton">
                <a ng-if="!userA.isAdded" ng-click="addGroupUser(userA)" style="text-decoration: none;">Add</a>
                <a ng-if="userA.isAdded" ng-click="removeGroupUser(userA)" style="text-decoration: none;">Remove</a>
              </div>
              <div>
                <span class="userTitleText">{{userA.userTitle}}</span>
              </div>
            </span>
            <div class="clear"></div>
          </div>

        </div>
        <div class="modal-footer">
          <button id="gcSubmitButton" ng-click="createGroup()">
            Submit
          </button>

          <button id="gcCloseButton" ng-click="closeCreateGroupModal()">
            Close
          </button>
        </div>
      </div>
    </div>
  </div>
  <!-- Create-Group modal ends -->

  <!-- Create-Group EDIT Modal -->
  <div id="editGroupModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content createGroupModal">
        <div class="modal-header">
          <span ng-mouseenter="showEdit = true" ng-mouseleave="showEdit = false">
            <input id="gnEdit" type="text" class="editGroupNameText" ng-model="selGroupName" focus-me="focusInput"
              disabled>
              <i ng-if="selGroupData.creatorUserId == user._id" ng-click="confirmModalGroupDel()" class="fa fa-trash groupDeleteIcon" aria-hidden="true"></i>

              <i ng-click="edit(); focusInput=true" ng-hide="editMode" class="fa fa-pencil-square-o editGroupName"
               aria-hidden="true"></i>
              <i ng-click="save()" ng-show="editMode" class="fa fa-check editGroupName" aria-hidden="true"></i>
          </span>
        </div>
        <div class="modal-body">

          <span ng-if="!addMemberStatus">
            <span class="totalPartic">Total Participants: {{selGrpMembers.length}}</span>
            <span><i ng-click="addMemberModalStatus()" class="fa fa-plus addMember" aria-hidden="true">Add
                Member</i></span>
          </span>

          <span ng-if="addMemberStatus">
            <span class="totalPartic">Users Selected: {{groupUsers.length}}</span>
          </span>

          <br><br>

          <div ng-if="!addMemberStatus" class="messages-recipients-list" id="messages-recipient-3"
            ng-repeat="userA in selGrpMembers">
            <span class="user-name-section">
              <div class="avatar pull-left">
                <span ng-if="userA.user_image == '' || !projectData.profileImgLocation">
                  <img ng-if="userA.receiverId != user._id" src="images/noProfile.png" alt="{{user.name}}" />
                </span>
                <span ng-if="userA.user_image != '' && projectData.profileImgLocation">
                  <img ng-if="userA.receiverId != user._id"
                    src="{{projectData.profileImgLocation}}{{userA.user_image }}" alt="{{userA.name}}" />
                </span>
              </div>
              <div class="messages-user-name" style="padding: 18px 0 0 0;">
                <span>{{userA.name}}</span>
                <i ng-if="userA.isAdded" class="fa fa-check" style="color: #a0d459;" aria-hidden="true"></i>
              </div>

              <div class="messages-user-name userAddButton">
                <a ng-if="userA._id != user._id" ng-click="removeCreatedGroupUser(userA)"
                  style="text-decoration: none;">Remove</a>
              </div>

              <div>
                <span class="userTitleText">{{userA.userTitle}}</span>
              </div>
            </span>
            <div class="clear"></div>
          </div>

          <div ng-if="addMemberStatus">
            <div style="border-bottom: 1px solid black;"></div>
            <h5 style="font-weight: 700;">Add to Group:</h5>

            <div class="messages-recipients-list" id="messages-recipient-3" ng-repeat="userA in nonGroupUsers"
              ng-if="userA._id != user._id">

              <span class="user-name-section">
                <div class="avatar pull-left">
                  <span ng-if="userA.user_image == '' || !projectData.profileImgLocation">
                    <img ng-if="userA.receiverId != user._id" src="images/noProfile.png" alt="{{user.name}}" />
                  </span>
                  <span ng-if="userA.user_image != '' && projectData.profileImgLocation">
                    <img ng-if="userA.receiverId != user._id"
                      src="{{projectData.profileImgLocation}}{{userA.user_image }}" alt="{{userA.name}}" />
                  </span>
                </div>
                <div class="messages-user-name" style="padding: 18px 0 0 0;">
                  <span>{{userA.name}}</span>
                  <i ng-if="userA.isAdded" class="fa fa-check" style="color: #a0d459;" aria-hidden="true"></i>
                </div>
                <div class="messages-user-name userAddButton">
                  <a ng-if="!userA.isAdded" ng-click="addGroupUser(userA)" style="text-decoration: none;">Add</a>
                  <a ng-if="userA.isAdded" ng-click="removeGroupUser(userA)" style="text-decoration: none;">Remove</a>
                </div>
                <div>
                  <span class="userTitleText">{{userA.userTitle}}</span>
                </div>
              </span>
              <div class="clear"></div>
            </div>

            <div ng-if="nonGroupUsers.length == 0">
              <h5> No Available Members to Add </h5>
            </div>

          </div>
        </div>
        <div class="modal-footer">
          <span ng-if="!addMemberStatus">
            <button id="gcCloseButton" ng-click="closeEditGroup()">
              Close
            </button>
            <!-- ******* Below Loop will be removed in future for better ************************* -->
            <span ng-repeat="userA in selGrpMembers">
              <button ng-if="userA._id == user._id" id="gcCloseButton" ng-click="removeCreatedGroupUser(userA)">
                Leave Group
              </button>
            </span>
          </span>

          <span ng-if="addMemberStatus">
            <button id="gcSubmitButton" ng-if="nonGroupUsers.length != 0" ng-click="submitNewMember()">
              Submit
            </button>

            <button id="gcCloseButton" ng-click="addMemberModalStatus()">
              Back
            </button>
          </span>

        </div>
      </div>
    </div>
  </div>
  <!-- Create-Group EDIT Modal -->

  <!-- Group Call start-->
  <div id="groupCallModal" class="modal fade customModalCentering" role="dialog">
    <div class="modal-dialog-custom">
      <div class="modal-content ">
        <div class="modal-header clearfix">
          <div class='text-white'>
            <b>Group Call</b>
            <span style="float: right;"><b>Joined Users: </b> {{joinedUsersList.length}}</span>
          </div>

          <span id="groupCallTime" style="color: white; float: right"></span>
        </div>
        <div class="modal-body groupCallModalContent">
          <!-- test area folks test area -->
          <!-- <video id="parentVideo" autoplay="autoplay" controls="controls"></video>-->
        </div>

        <div id="joinedUsersSection">
          <b ng-if="joinedUsersList.length > 0">Joined Users: </b>
          <span id="joinedUsersGroupList" ng-repeat="joiner in joinedUsersList track by $index">
           <span id="joinerName" style="padding-left: 10px;">
             {{joiner.name}} 
             <span ng-if="$index < (joinedUsersList.length-1)">, </span>
           </span>
          </span>
        </div>

        <div class="modal-footer" style="text-align: center;">
          <a id="minGroupCallBtn" href='javascript:void(0)' ng-click="minGroupCall()" class='btn btn-primary'>Chat</a>
          <a id="stopGroupCallBtn" href='javascript:void(0)' ng-click="stopGroupCall()" class='btn btn-danger'>Stop</a>
        </div>
      </div>
    </div>
  </div>
  <!-- Group Call end-->

  <!-- Incoming GroupCall Notification Modal -->
  <div id="incomingGroupCallModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header clearfix">
          <div class='col-md-4 text-white'>Incoming {{groupCallerName}} Call</div>
        </div>
        <div class="modal-body">
          <p id="incomingGroupCallMsg">There is group Call Going On, want to join?</p>
          <p id="incomingGroupCallTime"></p>
        </div>
        <div class="modal-footer">
          <a href='javascript:void(0)' ng-click="videoCall(0,0,1)" class='btn btn-primary'>Join</a>
          <a href='javascript:void(0)' ng-click="rejectIncomingGroupCall()" class='btn btn-danger'>Reject</a>
        </div>
      </div>
    </div>
  </div>
  <!-- Incoming GroupCall Notification end -->

  <div id="minimizedGroupCall" class="minimizedVideoTab minimizedVideoPanelMobile" data-backdrop="false">
    <div class="incomming-btn-container" style="background-color: white  !important">
      <img class="callImageAlign" src="images/Broadcast.png" style="width: 40%;">
      <button class="trans-btn maximizeIconAlign" title="call minimize" ng-click="minGroupCall();">
        <img src="images/callmaximizered.png" style="width: 30px">
      </button>
    </div>
  </div>
 
  <!-- <div ng-if="msgNotif" id ="msgNotification" class="alert alert-info alert-dismissible show msgNotif" role="alert">
    <span id="msgNotifText">{{msgNotifText}}</span>
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
      <span aria-hidden="true">&times;</span>
    </button>
  </div> -->

</div>

<script type="text/javascript">

  var socket = io.connect();

  $('#groupCreateButton').modal({ backdrop: 'static', keyboard: false })

  $(document).on('click', '.mobileopenlist', function () {
    $('.mobileleftpane').fadeIn(100);
  });

  $('mobilemsgclose').on('click', function () {
    $('.mobileleftpane').fadeOut(100);
  });
  $('#groups-message-tab').on('click', function () {
    $('#groups-message').addClass('in active');
    $('#users-message').removeClass('in active');
    $('.user-pointer').removeClass('active');
    $('.group-pointer').addClass('active');
  });
  $('#user-message-tab').on('click', function () {
    $('#users-message').addClass('in active');
    $('#groups-message').removeClass('in active');
    $('.group-pointer').removeClass('active');
    $('.user-pointer').addClass('active');
  });
  function Wo_GetUserMessages(user_id, user_name, userlink) {
    view_more_wrapper = $('.view-more-wrapper');
    $('.text-sender-container').find('.ball-pulse').fadeIn(100);
    $('#user-name').html('<a style="color: #fff" target="_blank" href="https://www.talksns.com/' + userlink + '">' + user_name + '</a>').removeClass('hidden');
    $('#user-id').attr('value', user_id);
    $('#messages-group-id').attr('value', 0);
    $('#messages-recipient-' + user_id).find('.new-message-alert').fadeOut(200);
    $.get(Wo_Ajax_Requests_File(), {
      f: 'messages',
      s: 'get_user_messages',
      user_id: user_id
    }, function (data) {
      if (data.status == 200) {
        if (data.color) {
          $(".text-sender-container .red-list").css('background', data.color);
          $(".text-sender-container .btn-file").css('background', data.color);
          $(".text-sender-container .btn-file").css('border-color', data.color);
        }
        $('#charsLeft').text("640");
        Wo_getMessageSeen();
        $('.emo-message').fadeIn(200);
        $('.text-sender-container').find('.ball-pulse').fadeOut(100);
      }
    });
  }

  // Hide Header on on scroll down
  $(function () {
    var lastScrollTop = 0, delta = 5;
    $('.messages-container').scroll(function (event) {
      var st = $(this).scrollTop();

      if (Math.abs(lastScrollTop - st) <= delta)
        return;

      if (st > lastScrollTop) {
        // downscroll code
        $(".messages-load-more-messages").css("top", "27px")
          .hover(
            function () {
              $(".messages-load-more-messages").css("top", "50px");
            }
          )
      } else {
        // upscroll code
        $(".messages-load-more-messages").css("top", "50px");
      }
      lastScrollTop = st;
    });
  });

  function triggerfile() {
    $('input[name="avatar"]').trigger('click');
  }


  $(document).ready(function () {
    $("#example1").emojioneArea({
      standalone: true
    });
  });


  $(document).ready(function () {
    $("#sendMsg").emojioneArea({
      events: {
        keypress: function (editor, event) {
          socket.emit('typing');
        },
        keyup: function (editor, event) {
          this.source.val(this.getText());
          if (event.keyCode == 13) {
            var text = this.source.val();
            var scope = angular.element(document.getElementById("MainWrap")).scope();
            scope.$apply(function () {
              scope.message = text;
              scope.sendMessage();
            });
          }
        }
      }
    });


    $('.chat_list').click(function () {
      $('.chat_list').css("border-left", "1px solid red");
      $('.chat_list').addClass("active");
    });

    $('#side-btn').click(function () {
      $('#mobile-view-contact').toggle();
    });

    /* show docker*/
    $("body").on('click', '.addClass', function () {
      $('#sidebar_secondary').addClass('popup-box-on');
    });
    /* hide docker */
    $("#removeClass").click(function () {
      $('#sidebar_secondary').removeClass('popup-box-on');
    });

    $(".videoTabNew").draggable();
    $(".audioTab").draggable();
    $("#incommingCall").draggable();
    $("#videoBroadCast").draggable();
  });

  function removeVideoTab() {
    var ele = document.querySelector('.videoTabNew');
    ele.style.display = 'none';
  }

  function closeModal(id) {
    setTimeout(function () {
      $('#' + id).trigger('click');
    }, 100);
  }
  function toggle() {
    $('.mesgs1').show();
    $('#mobile-view-contact').hide();
  }

  $(document).on('click', '.makeFullScreen', function () {
    $(".2wayChat").addClass('fullScreen');
    $(this).addClass('hidden');
    $(".exitTheScreen").removeClass('hidden');
  });


  $(document).on('click', '.exitTheScreen', function () {
    $(".2wayChat").removeClass('fullScreen');
    $(this).addClass('hidden');
    $(".makeFullScreen").removeClass('hidden');
  });

  jQuery(function ($) { // DOM ready
    $('.tabs').each(function () {

      var $tab = $(this).find(".tab");

      $tab.on("click", function () {

        var tabId = this.id.replace(/\D/g, '');

        $tab.not(this).removeClass('current');
        $(this).addClass('current');

        $(".tabContent").removeClass("current");
        $("#tabs-" + tabId).addClass("current");

      });
    });
  });

  function scrolltopUserList() {
    var con = document.getElementById('usersList');
    con.scrollTop = 0;
  }


  function scrollbottom() {
    var con = document.getElementsByClassName('msg_history')[0];
    // console.log(con.scrollTop);
    // console.log($('.msg_history').prop("scrollHeight"));

    setTimeout(function () {
      con.scrollTo(0, $('.msg_history').prop("scrollHeight"));
    }, 200);
  }

  var executeOnce = false;
  var secondScrollHeight;
  var fTotalHeight;

  function scrollCustom() {
    var con = document.getElementsByClassName('msg_history')[0];
    setTimeout(function () {
      secondScrollHeight = con.scrollHeight - fTotalHeight;
      con.scrollTop = secondScrollHeight;
      fTotalHeight = con.scrollHeight;
    }, 200);
  }

  // function getScrollHeight(){
  //   // var con = document.getElementsByClassName('msg_history')[0];
  //   // console.log(con.scrollHeight);
  //   return scrollHeight;
  // }

  function scrolled(o) {
    if (!executeOnce) {
      executeOnce = true;
      fTotalHeight = o.scrollHeight;
    }

    //visible height + pixel scrolled = total height
    if (o.offsetHeight + o.scrollTop == o.scrollHeight) {
      // right now, no use ...
    }
    else if (o.scrollTop == 0) {
      console.log("getting more chat");
      angular.element(document.getElementById('MainWrap')).scope().getMoreChat();
    }
  }

  function resetScrollVar() {
    executeOnce = false;
    secondScrollHeight = 0;
    fTotalHeight = 0;
  }

  function reLoadEmoji() {
    $("#sendBMsg").emojioneArea();
  }

  $("#sendBMsg").emojioneArea({
    events: {
      keypress: function (editor, event) {
        socket.emit('typing');
      },
      keyup: function (editor, event) {

        this.source.val(this.getText());

        if (event.keyCode == 13) {
          var text = this.source.val();
          var scope = angular.element(document.getElementById("MainWrap")).scope();
          scope.$apply(function () {
            //scope.sendType = 'chat';

            scope.message = text;
            scope.sendBCMessage();
          });
        }
      }
    }
  });

  //---- handles the panel's display status of AvailableBroadCasters----
  function showAvailableBroadCasters() {
    var ele = document.querySelector('.avialableBroadcasters');
    ele.style.display = 'block';
  }

  function hideAvailableBroadCasters() {
    var ele = document.querySelector('.avialableBroadcasters');
    ele.style.display = 'none';
  }
  //-------------------------------------------------------------------

</script>